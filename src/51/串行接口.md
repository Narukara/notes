## 串行接口

发送/接收缓冲器 SBUF

**串行接口控制寄存器SCON**

| D7   | D6   | D5   | D4   | D3   | D2   | D1   | D0   |
| ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| SM0  | SM1  | SM2  | REN  | TB8  | RB8  | TI   | RI   |

| SM0  | SM1  | 工作方式  | 功能                 | 波特率                     |
| ---- | ---- | --------- | -------------------- | -------------------------- |
| 0    | 0    | 工作模式0 | 同步移位寄存器方式   | $f_{osc}/12$               |
| 0    | 1    | 工作模式1 | 10位异步发送接收方式 | 由定时器控制               |
| 1    | 0    | 工作模式2 | 11位异步发送接收方式 | $f_{osc}/32$或$f_{osc}/64$ |
| 1    | 1    | 工作模式3 | 11位异步发送接收方式 | 由定时器控制               |

- SM2 : 多机串行通信的控制位. SM2 = 1时, (从机)仅接收地址帧(RB8 = 1), SM2 = 0时, (从机)接收所有数据.
- REN : 串行数据接收允许/禁止控制位. REN = 1时, 允许接收串行数据; REN = 0时, 禁止接收串行数据.
- TB8 : 主要用于模式2和3中, 作为**发送**数据的第9位, 在模式0和模式1中, TB8位不使用. 常作为奇偶校验位, 在多机串行通信中, 也可以作为地址帧和数据帧的区分标志位.
- RB8 : 主要用于模式2和3中, 作为**接收**数据的第9位. 在模式1中, 如果SM2 = 0, 即采用的不是多机通信模式, 则RB8是已接收到的停止位. 在模式0中, 该位不使用.
- TI : 串行数据发送中断请求标志位. 在一帧串行数据发送结束的时候, 由单片机硬件自动置位. 如果 TI = 1 则表示发送缓冲器已空, 通知CPU可以发送下一帧数据. 在模式0中, 串行发送完8位数据时便进行硬件置位, 其他模式中, 串行发送到停止位的时候由硬件置位. **不会自动复位, 需要手动清零**.
- RI : 串行数据接收中断请求标志位. 在接收到一帧有效的串行数据后, 由单片机硬件置位. 如果 RI = 1 则表示接收缓冲器已满, 通知CPU可以将数据取走. 在模式0中, 串行接收完8位数据时便进行硬件置位, 其他模式中, 串行接收到停止位的时候由硬件置位. **不会自动复位, 需要手动清零**.

**特殊功能寄存器PCON** **(不支持位寻址)**

| D7   | D6   | D5   | D4   | D3   | D2   | D1   | D0   |
| ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| SMOD | -    | -    | -    | GF1  | GF0  | PD   | IDL  |

- D0~D3表示CHMOS型单片机的掉电控制位
- SMOD : 波特率倍增位, 在模式1,2,3下, 如果置SMOD = 1, 则波特率提高一倍, 如果SMOD = 0, 则波特率不变. 在模式0下不起作用.

| 波特率(bit/s) | \\(f_{osc}(MHz)\\) | SMOD | T1工作模式 | 初值  |
| ------------- | -------------- | ---- | ---------- | ----- |
| 4800          | 16             | 1    | 2          | EFH   |
| 2400          | 16             | 0    | 2          | EFH   |
| 2400          | 16             | 1    | 2          | DDH   |
| 1200          | 16             | 0    | 2          | DDH   |
| 1200          | 16             | 1    | 2          | BBH   |
| 600           | 16             | 0    | 2          | BBH   |
| 600           | 16             | 1    | 2          | 75H   |
| 300           | 16             | 0    | 2          | 75H   |
| 4800          | 12             | 1    | 2          | F3H   |
| 2400          | 12             | 0    | 2          | F3H   |
| 2400          | 12             | 1    | 2          | E6H   |
| 1200          | 12             | 0    | 2          | E6H   |
| 1200          | 12             | 1    | 2          | CCH   |
| 600           | 12             | 0    | 2          | CCH   |
| 600           | 12             | 1    | 2          | 98H   |
| 300           | 12             | 0    | 2          | 98H   |
| 300           | 12             | 1    | 2          | 30H   |
| 110           | 12             | 0    | **1**      | FEEBH |
| 56800         | 11.0592        | 1    | 2          | FFH   |
| 19200         | 11.0592        | 1    | 2          | FDH   |
| 9600          | 11.0592        | 0    | 2          | FDH   |
| 9600          | 11.0592        | 1    | 2          | FAH   |
| 4800          | 11.0592        | 0    | 2          | FAH   |
| 4800          | 11.0592        | 1    | 2          | F4H   |
| 2400          | 11.0592        | 0    | 2          | F2H   |
| 2400          | 11.0592        | 1    | 2          | E8H   |
| 1200          | 11.0592        | 0    | 2          | E8H   |
| 1200          | 11.0592        | 1    | 2          | D0H   |
| 600           | 11.0592        | 0    | 2          | D0H   |
| 600           | 11.0592        | 1    | 2          | A0H   |
| 300           | 11.0592        | 0    | 2          | A0H   |
| 300           | 11.0592        | 1    | 2          | 40H   |
| 1200          | 6              | 0    | 2          | F3H   |
| 110           | 6              | 0    | 2          | 72H   |
